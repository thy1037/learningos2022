<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>汇编指令 - HY Tang&#x27;s Blog</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">简介</a></li><li class="chapter-item expanded affix "><li class="part-title">Rust</li><li class="chapter-item expanded "><a href="rust-based-os-comp2022.html"><strong aria-hidden="true">1.</strong> 2022 开源操作系统学习笔记</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="rust-based-os-comp2022-Phase1-weekly.html"><strong aria-hidden="true">1.1.</strong> 阶段一 周报</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="rust-based-os-comp2022-lab1.html"><strong aria-hidden="true">1.1.1.</strong> LAB1 实验报告</a></li><li class="chapter-item expanded "><a href="rust-based-os-comp2022-lab2.html"><strong aria-hidden="true">1.1.2.</strong> LAB2 实验报告</a></li><li class="chapter-item expanded "><a href="rust-based-os-comp2022-lab3.html"><strong aria-hidden="true">1.1.3.</strong> LAB3 实验报告</a></li><li class="chapter-item expanded "><a href="rust-based-os-comp2022-lab4.html"><strong aria-hidden="true">1.1.4.</strong> LAB4 实验报告</a></li><li class="chapter-item expanded "><a href="rust-based-os-comp2022-lab5.html"><strong aria-hidden="true">1.1.5.</strong> LAB5 实验报告</a></li></ol></li><li class="chapter-item expanded "><a href="rust-based-os-comp2022-Phase2-weekly.html"><strong aria-hidden="true">1.2.</strong> 阶段二 周报</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="rust-based-os-comp2022-Phase2-toolchain.html"><strong aria-hidden="true">1.2.1.</strong> 工具链及基础工程</a></li></ol></li></ol></li><li class="chapter-item expanded "><li class="part-title">RISC-V</li><li class="chapter-item expanded "><a href="computer-organization-and-design.html"><strong aria-hidden="true">2.</strong> 计算机组成与设计：RISC-V</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="asm-code.html" class="active"><strong aria-hidden="true">2.1.</strong> 汇编指令</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">HY Tang&#x27;s Blog</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="汇编指令"><a class="header" href="#汇编指令">汇编指令</a></h1>
<h2 id="算术指令"><a class="header" href="#算术指令">算术指令</a></h2>
<ul>
<li><strong>In RISC-V Assembly Language:</strong> <br>
Registers replace C Variables <br>
One instruction (simple operation) per line <br>
Simpler is Better, Smaller is Faster</li>
<li><strong>In RV32, words are 32b</strong></li>
<li><strong>Instructions: add, addi, sub</strong></li>
<li><strong>Register:</strong> <br>
32 registers, reffered to as x0 - x31 <br>
Zero: x0</li>
</ul>
<p>寄存器描述：</p>
<table><thead><tr><th>Register</th><th>ABI</th><th>Preserved?</th><th>Use by convention</th></tr></thead><tbody>
<tr><td>x0</td><td>zero</td><td>n/a</td><td>hardwired to 0, ignore writes</td></tr>
<tr><td>x1</td><td>ra</td><td>no</td><td>return address for jumps</td></tr>
<tr><td>x2</td><td>sp</td><td>yes</td><td>stack pointer</td></tr>
<tr><td>x3</td><td>gp</td><td>n/a</td><td>global pointer</td></tr>
<tr><td>x4</td><td>tp</td><td>n/a</td><td>thread pointer</td></tr>
<tr><td>x5</td><td>t0</td><td>no</td><td>temporary register 0</td></tr>
<tr><td>x6</td><td>t1</td><td>no</td><td>temporary register 1</td></tr>
<tr><td>x7</td><td>t2</td><td>no</td><td>temporary register 2</td></tr>
<tr><td>x8</td><td>s0 or fp</td><td>yes</td><td>saved register 0 or frame pointer</td></tr>
<tr><td>x9</td><td>s1</td><td>yes</td><td>saved register 1</td></tr>
<tr><td>x10</td><td>a0</td><td>no</td><td>return value or function argument 0</td></tr>
<tr><td>x11</td><td>a1</td><td>no</td><td>return value or function argument 1</td></tr>
<tr><td>x12</td><td>a2</td><td>no</td><td>return value or function argument 2</td></tr>
<tr><td>x13</td><td>a3</td><td>no</td><td>return value or function argument 3</td></tr>
<tr><td>x14</td><td>a4</td><td>no</td><td>return value or function argument 4</td></tr>
<tr><td>x15</td><td>a5</td><td>no</td><td>return value or function argument 5</td></tr>
<tr><td>x16</td><td>a6</td><td>no</td><td>return value or function argument 6</td></tr>
<tr><td>x17</td><td>a7</td><td>no</td><td>return value or function argument 7</td></tr>
<tr><td>x18</td><td>s2</td><td>yes</td><td>saved register 2</td></tr>
<tr><td>x19</td><td>s3</td><td>yes</td><td>saved register 3</td></tr>
<tr><td>x20</td><td>s4</td><td>yes</td><td>saved register 4</td></tr>
<tr><td>x21</td><td>s5</td><td>yes</td><td>saved register 5</td></tr>
<tr><td>x22</td><td>s6</td><td>yes</td><td>saved register 6</td></tr>
<tr><td>x23</td><td>s7</td><td>yes</td><td>saved register 7</td></tr>
<tr><td>x24</td><td>s8</td><td>yes</td><td>saved register 8</td></tr>
<tr><td>x25</td><td>s9</td><td>yes</td><td>saved register 9</td></tr>
<tr><td>x26</td><td>s10</td><td>yes</td><td>saved register 10</td></tr>
<tr><td>x27</td><td>s11</td><td>yes</td><td>saved register 11</td></tr>
<tr><td>x28</td><td>t3</td><td>no</td><td>temporary register 3</td></tr>
<tr><td>x29</td><td>t4</td><td>no</td><td>temporary register 4</td></tr>
<tr><td>x30</td><td>t5</td><td>no</td><td>temporary register 5</td></tr>
<tr><td>x31</td><td>t6</td><td>no</td><td>temporary register 6</td></tr>
<tr><td>pc</td><td>(none)</td><td>n/a</td><td>program counter</td></tr>
</tbody></table>
<p>指令描述：</p>
<table><thead><tr><th>Name</th><th>Fmt</th><th>RV32I Base</th><th>Note</th></tr></thead><tbody>
<tr><td>ADD</td><td>R</td><td>ADD rd, rs1, rs2</td><td>rd = rs1 + rs2 <br> R: rigid <br> rd: register destination <br> rs: register source</td></tr>
<tr><td>ADD Immediate</td><td>I</td><td>ADDI rd, rs1, imm</td><td>rd = rs1 + imm</td></tr>
<tr><td>SUB Tract</td><td>R</td><td>SUB rd, rs1, rs2</td><td>rd = rs1 - rs2</td></tr>
</tbody></table>
<h2 id="访存指令"><a class="header" href="#访存指令">访存指令</a></h2>
<ul>
<li><strong>Memory is <code>byte</code>-addressable, but <code>lw</code> and <code>sw</code> access one <code>word</code> at a time</strong></li>
<li><strong>A pointer (used by <code>lw</code> and <code>sw</code>) is just a memory address, we can add to it or subtract from it(using offset)</strong></li>
<li><strong>New Instructions: <code>lw</code>, <code>sw</code>, <code>lb</code>, <code>sb</code>, <code>lbu</code></strong></li>
</ul>
<p>指令描述：</p>
<table><thead><tr><th>Name</th><th>Fmt</th><th>RV32I Base</th><th>Note</th></tr></thead><tbody>
<tr><td>Load Byte</td><td>I</td><td>LB rd, rs1, imm</td><td></td></tr>
<tr><td>Load Halfword</td><td>I</td><td>LH rd, rs1, imm</td><td></td></tr>
<tr><td>Load Byte Unsigned</td><td>I</td><td>LBU rd, rs1, imm</td><td></td></tr>
<tr><td>Load Half Unsigned</td><td>I</td><td>LHU rd, rs1, imm</td><td></td></tr>
<tr><td>Load Word</td><td>I</td><td>LW rd, rs1, imm</td><td></td></tr>
<tr><td>Store Byte</td><td>S</td><td>SB rs1, rs2, imm</td><td></td></tr>
<tr><td>Store Halfword</td><td>S</td><td>SH rs1, rs2, imm</td><td></td></tr>
<tr><td>Store Word</td><td>S</td><td>SW rs1, rs2, imm</td><td></td></tr>
</tbody></table>
<h2 id="条件判断分支转移指令"><a class="header" href="#条件判断分支转移指令">条件判断分支转移指令</a></h2>
<ul>
<li><strong>A decision allows us to decide what to execute at run-time rather than compile-time</strong></li>
<li><strong>C Decisions are made using conditional statements within if, while, do while, for</strong></li>
<li><strong>RISC-V Decision making instructions are the conditional branches</strong></li>
<li><strong>New Instructions: <code>beq</code>, <code>bne</code>, <code>blt</code>, <code>bltu</code>, <code>bge</code>, <code>j</code></strong></li>
</ul>
<p>指令描述：</p>
<table><thead><tr><th>Name</th><th>Fmt</th><th>RV32I Base</th><th>Note</th></tr></thead><tbody>
<tr><td>Branch ==</td><td>B</td><td>BEQ rs1, rs2, imm</td><td>BEQ: Branch Equal</td></tr>
<tr><td>Branch !=</td><td>B</td><td>BNE rs1, rs2, imm</td><td>BNE: Branch Not Equal</td></tr>
<tr><td>Branch &lt;</td><td>B</td><td>BLT rs1, rs2, imm</td><td>BLT: Branch Less Than</td></tr>
<tr><td>Branch &gt;=</td><td>B</td><td>BGE rs1, rs2, imm</td><td>BGE: Branch Greate Equal</td></tr>
<tr><td>Branch &lt; Unsigned</td><td>B</td><td>BLTU rs1, rs2, imm</td><td></td></tr>
<tr><td>Branch &gt;= Unsigned</td><td>B</td><td>BGEU rs1, rs2, imm</td><td></td></tr>
</tbody></table>
<h2 id="逻辑运算指令"><a class="header" href="#逻辑运算指令">逻辑运算指令</a></h2>
<ul>
<li><strong>New Instructions: <code>sll</code>, <code>srl</code>, <code>slli</code>, <code>sra</code>, <code>srai</code>, <code>and</code>, <code>or</code>, <code>xor</code>, <code>andi</code>, <code>ori</code>, <code>xori</code></strong></li>
</ul>
<p>指令描述：</p>
<table><thead><tr><th>Name</th><th>Fmt</th><th>RV32I Base</th><th>Note</th></tr></thead><tbody>
<tr><td>Shift Left Logical</td><td>R</td><td>SLL rd, rs1, rs2</td><td></td></tr>
<tr><td>Shift Left Log. Imm.</td><td>I</td><td>SLLI rd, rs1, shamt</td><td></td></tr>
<tr><td>Shift Right Logical</td><td>R</td><td>SRL rd, rs1, rs2</td><td></td></tr>
<tr><td>Shift Right Log. Imm.</td><td>R</td><td>SRLI rd, rs1, rs2</td><td></td></tr>
<tr><td>Shift Right Arithmetic</td><td>R</td><td>SRA rd, rs1, rs2</td><td></td></tr>
<tr><td>Shift Right Arith. Imm.</td><td>I</td><td>SRAI rs, rs1, rs2</td><td></td></tr>
<tr><td>XOR</td><td>R</td><td>XOR rd, rs1, rs2</td><td></td></tr>
<tr><td>XOR Imm.</td><td>I</td><td>XORI rd, rs1, imm</td><td></td></tr>
<tr><td>OR</td><td>R</td><td>OR rd, rs1, rs2</td><td></td></tr>
<tr><td>OR Imm.</td><td>I</td><td>ORI rd, rs1, imm</td><td></td></tr>
<tr><td>AND</td><td>R</td><td>AND rd, rs1, rs2</td><td></td></tr>
<tr><td>AND Imm.</td><td>I</td><td>ANDI rd, rs1, imm</td><td></td></tr>
</tbody></table>
<h2 id="函数调用指令"><a class="header" href="#函数调用指令">函数调用指令</a></h2>
<ul>
<li><strong>Registers</strong>
a0-a7 for function arguments, a0-a1 for return values <br>
ra return address <br>
s0-s11 saved registers <br>
zero <br></li>
<li><strong>Instructions</strong>
Unconditinal branches(jumps): <code>j</code>, <code>jr</code> <br>
Functions called with <code>jal</code>, return with <code>jr ra</code>  <br></li>
</ul>
<p>指令描述：</p>
<table><thead><tr><th>Name</th><th>Fmt</th><th>RV32I Base</th><th>Note</th></tr></thead><tbody>
<tr><td>Jump and Link</td><td>J</td><td>JAL rd, imm</td><td></td></tr>
<tr><td>Jump &amp; Link Register</td><td>I</td><td>JALR rd, rs1, imm</td><td></td></tr>
</tbody></table>
<h2 id="指令格式"><a class="header" href="#指令格式">指令格式</a></h2>
<p><img src="imgs/risc-v-32bit-instruction-formats.png" alt="instruction-formats" /></p>
<p>其中：</p>
<ol>
<li><code>rd</code>, <code>rs1</code>, <code>rs2</code> 都占 5 bit，对应 0～31 寄存器</li>
<li>除 U型和 J型指令，其余指令格式中，立即数只占 12bit，对于大立即数的表示，需要用到 U型指令进行高 20bit填充 <br> <strong>注意</strong>：12bit为有符号数，当数值的低12位的符号为1时，将利用 <code>LUI</code> 装入的高 20位立即数预先加1，而 <code>ADDI</code> 写入的低 12位不变。伪指令 <code>LI</code> 用于此种情况，实际会创建两条指令（<code>LUI</code> <code>ADDI</code>)</li>
</ol>
<h2 id="数据通路datapath"><a class="header" href="#数据通路datapath">数据通路（Datapath）</a></h2>
<ol>
<li>Instruction Fetch(IF, 取址)</li>
<li>Instruction Decode(ID, 译码)</li>
<li>Execute Arithmetic-Logic Unit(EX ALU, 执行)</li>
<li>Memory Access (MA, 访存)</li>
<li>Write Back to Register(WB, 写回)</li>
</ol>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="computer-organization-and-design.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="computer-organization-and-design.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
